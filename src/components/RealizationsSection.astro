---
import { Image } from 'astro:assets';
import systemZarzadzaniaEnergia from '../assets/system-zarzadzania-energia.webp';
import inteligetneOswietlenieLed from '../assets/inteligetne-oswietlenie-led.webp';
import systemAutomatykiBudowlanej from '../assets/system-automatyki-budowlanej.jpg';

const projects = [
	{
		title: 'System Zarządzania Energią',
		client: 'Centrum Handlowe Galaxy',
		image: systemZarzadzaniaEnergia,
		category: 'Energetyka',
		testimonial: 'Profesjonalne podejście i terminowa realizacja. System znacząco obniżył nasze koszty energii.',
		author: 'Jan Kowalski',
		position: 'Dyrektor Techniczny',
	},
	{
		title: 'Inteligentne Oświetlenie LED',
		client: 'Miasto Opole',
		image: inteligetneOswietlenieLed,
		category: 'Oświetlenie',
		testimonial: 'Kompleksowa modernizacja oświetlenia miejskiego przyniosła oczekiwane oszczędności i poprawiła bezpieczeństwo.',
		author: 'Anna Nowak',
		position: 'Kierownik Projektu',
	},
	{
		title: 'System Automatyki Budynkowej',
		client: 'Business Park Plaza',
		image: systemAutomatykiBudowlanej,
		category: 'Automatyka',
		testimonial: 'Wdrożony system automatyki spełnił wszystkie nasze oczekiwania. Polecamy współpracę z Bluesoft.',
		author: 'Piotr Wiśniewski',
		position: 'Facility Manager',
	},
	{
		title: 'Smart Home Integration',
		client: 'Osiedle Zielona Dolina',
		image: systemZarzadzaniaEnergia,
		category: 'Automatyka Domowa',
		testimonial: 'Innowacyjne rozwiązania smart home znacząco podniosły standard naszego osiedla.',
		author: 'Marta Zielińska',
		position: 'Zarządca Nieruchomości',
	},
];
---

<section class="py-20 bg-gray-50">
	<div class="container mx-auto px-6">
		<!-- Section Header -->
		<div class="text-center mb-16" data-aos="fade-up">
			<h2 class="text-4xl font-bold text-primary mb-4">Nasze Realizacje</h2>
			<p class="text-xl text-gray-600">Zobacz, co udało nam się osiągnąć dla naszych klientów</p>
		</div>

		<!-- Projects Grid -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
			{
				projects.slice(0, 3).map((project, index) => (
					<div data-aos="fade-up" data-aos-delay={index * 100} class="bg-white rounded-lg shadow-lg overflow-hidden group">
						<div class="relative overflow-hidden">
							<Image
								src={project.image}
								alt={project.title}
								class="w-full h-64 object-cover transform group-hover:scale-105 transition-transform duration-500"
							/>
							<div class="absolute inset-0 bg-primary/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
								<a
									href={`/realizacje/${project.title.toLowerCase().replace(/\s+/g, '-')}`}
									class="text-white text-lg font-medium hover:underline"
								>
									Zobacz więcej
								</a>
							</div>
						</div>
						<div class="p-6">
							<span class="text-sm text-accent font-medium">{project.category}</span>
							<h3 class="text-xl font-bold text-gray-900 mt-2">{project.title}</h3>
							<p class="text-gray-600 mt-2">{project.client}</p>
						</div>
					</div>
				))
			}
		</div>

		<!-- Testimonials Slider -->
		<div class="w-full overflow-hidden" data-aos="fade-up">
			<div class="relative px-4">
				<!-- Testimonials Container -->
				<div class="keen-slider" id="testimonials-slider">
					{
						projects.map((project) => (
							<div class="keen-slider__slide px-4">
								<div class="bg-white rounded-xl shadow-lg p-8 text-center max-w-2xl mx-auto">
									<div class="text-accent text-4xl mb-6">"</div>
									<blockquote class="text-gray-600 text-lg italic mb-6">{project.testimonial}</blockquote>
									<div class="font-medium">
										<cite class="text-gray-900 not-italic">{project.author}</cite>
										<p class="text-accent mt-1">{project.position}</p>
									</div>
								</div>
							</div>
						))
					}
				</div>
			</div>
		</div>

		<script>
			import KeenSlider from 'keen-slider';

			document.addEventListener('DOMContentLoaded', () => {
				const sliderElement = document.getElementById('testimonials-slider');
				if (!sliderElement) return;
				const screenWidth = window.innerWidth;
				const baseDuration = 20000;
				const durationMultiplier = Math.max(1, screenWidth / 1000);
				const animation = {
					duration: baseDuration * durationMultiplier,
					easing: (t) => t,
				};
				const slider = new KeenSlider(sliderElement, {
					loop: true,
					slides: {
						origin: 'center',
						perView: 1,
					},
					breakpoints: {
						'(min-width: 800px)': {
							slides: {
								perView: 3,
							},
						},
					},
					created(s) {
						s.moveToIdx(5, true, animation);
					},
					updated(s) {
						s.moveToIdx(s.track.details.abs + 5, true, animation);
					},
					animationEnded(s) {
						s.moveToIdx(s.track.details.abs + 5, true, animation);
					},
				});

				return () => {
					if (slider) slider.destroy();
				};
			});
		</script>

		<style>
			@import 'keen-slider/keen-slider.min.css';
			.keen-slider {
				width: 100%;
				min-height: 200px;
			}

			.keen-slider__slide {
				width: 100%;
				min-width: 0;
				padding-bottom: 20px;
			}
		</style>
	</div>
</section>
